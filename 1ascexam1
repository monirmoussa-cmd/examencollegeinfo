<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>R√©vision Informatique - Examens A, B, C, D</title>
    <style>
        /* CSS pour le style et l'interactivit√© */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f9;
            color: #333;
        }
        .container {
            max-width: 900px;
            margin: 30px auto;
            padding: 20px;
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        h1 {
            text-align: center;
            color: #2a6496;
            border-bottom: 2px solid #2a6496;
            padding-bottom: 10px;
        }
        
        /* Styles pour la s√©lection de l'examen */
        .exam-selection {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #337ab7;
            border-radius: 8px;
            background-color: #eaf2f8;
        }
        .exam-selection label {
            font-size: 18px;
            font-weight: bold;
            margin: 0 15px;
            cursor: pointer;
            padding: 8px 12px;
            border: 2px solid transparent;
            border-radius: 5px;
            transition: background-color 0.2s;
        }
        .exam-selection label:hover {
            background-color: #d4e3f1;
        }
        .exam-selection input[type="radio"] {
            margin-right: 5px;
            vertical-align: middle;
        }

        /* Styles pour la section d'identification */
        .user-info-section {
            margin-bottom: 30px; 
            padding: 20px; 
            border: 1px solid #337ab7; 
            border-radius: 8px; 
            background-color: #f0f8ff;
        }
        .user-info-section h3 {
            margin-top: 0;
            color: #2a6496;
        }
        .user-info-field {
            display: flex; 
            gap: 20px; 
            margin-bottom: 15px; 
            align-items: center;
        }
        .user-info-field label {
            font-weight: bold; 
            min-width: 150px;
        }
        .user-info-field input[type="text"], .user-info-field select {
            flex-grow: 1; 
            padding: 8px; 
            border-radius: 4px; 
            border: 1px solid #ccc;
            font-size: 16px;
        }

        /* Conteneur des questions √† afficher apr√®s s√©lection */
        #quiz-form-container {
            display: none; /* Masqu√© par d√©faut */
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }

        .question-section {
            margin-bottom: 25px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #fafafa;
        }
        /* Styles pour le retour utilisateur apr√®s v√©rification */
        .question-section.correct {
            background-color: #dff0d8; /* Vert l√©ger pour succ√®s */
            border-color: #5cb85c;
        }
        .question-section.incorrect {
            background-color: #f2dede; /* Rouge l√©ger pour √©chec */
            border-color: #d9534f;
        }
        .question-title {
            font-weight: bold;
            color: #2a6496; /* Couleur bleue pour les titres de question */
            margin-bottom: 15px;
        }
        .options label {
            display: block;
            margin: 8px 0;
            cursor: pointer;
        }
        /* Mise en √©vidence des r√©ponses correctes/incorrectes apr√®s soumission */
        .question-section.checked label {
            padding: 2px 5px;
            border-radius: 3px;
        }
        .question-section.checked input[data-correct="false"]:checked + span,
        .question-section.checked input[data-correct="false"]:checked + label {
            background-color: #d9534f; /* Rouge fonc√© pour s√©lection incorrecte */
            color: white;
            font-weight: bold;
        }
        .question-section.checked input[data-correct="true"] + span,
        .question-section.checked input[data-correct="true"] + label {
             background-color: #5cb85c; /* Vert pour r√©ponse correcte */
             color: white;
             font-weight: bold;
        }
        .options input[type="radio"], .options input[type="checkbox"] {
            margin-right: 10px;
        }

        /* Styles pour le Drag and Drop (Texte √† trous) */
        .drag-zone {
            display: flex;
            flex-wrap: wrap;
            margin-bottom: 15px;
            border-bottom: 1px solid #ccc;
            padding-bottom: 10px;
        }
        .drag-word {
            background-color: #f0ad4e;
            color: white;
            padding: 8px 12px;
            margin: 5px;
            border-radius: 5px;
            cursor: grab;
            font-weight: bold;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.2);
            transition: background-color 0.3s;
        }
        .drop-target {
            display: inline-block;
            min-width: 120px; 
            height: 35px;
            border: 2px dashed #999;
            border-radius: 5px;
            margin: 0 5px;
            text-align: center;
            line-height: 30px;
            vertical-align: middle;
            background-color: #eee;
        }
        .drop-target.hover {
            border-color: #337ab7;
            background-color: #eaf2f8;
        }
        .drop-target.filled {
            border: none;
            background-color: transparent;
            min-width: auto;
            height: auto;
            padding: 0;
            margin: 0;
            line-height: normal;
        }
        .question-text-line {
            line-height: 40px;
        }
        .question-text-line span {
            margin: 0 5px;
        }
        
        /* Styles pour Matching */
        .matching-pair {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .matching-pair div.term {
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            width: 45%;
            text-align: center;
            background-color: #e6e6ff;
            font-weight: bold;
        }
        .definition-select {
            padding: 8px;
            width: 50%;
            border-radius: 4px;
            border: 1px solid #337ab7;
            transition: border-color 0.3s;
        }
        .matching-pair.correct .definition-select {
            border-color: #5cb85c;
            background-color: #dff0d8;
        }
        .matching-pair.incorrect .definition-select {
            border-color: #d9534f;
            background-color: #f2dede;
        }

        /* Bouton de soumission final */
        .submit-btn {
            display: block;
            width: 100%;
            padding: 15px;
            background-color: #337ab7;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
            margin-top: 30px;
            transition: background-color 0.2s;
        }
        .submit-btn:hover {
            background-color: #286090;
        }
        .submit-btn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        #score-container {
            text-align: center;
            font-size: 22px;
            margin-top: 30px;
            padding: 20px;
            border: 2px solid #f0ad4e;
            background-color: #fcf8e3;
            border-radius: 8px;
            font-weight: bold;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>üìù Devoir / Examen d'Informatique - Cours 1 √† 3 & 5-6</h1>

    <div class="exam-selection">
        <h2>S√©lectionnez votre version d'examen :</h2>
        <label><input type="radio" name="exam_version" value="A" onclick="startQuiz('A')"> Examen A</label>
        <label><input type="radio" name="exam_version" value="B" onclick="startQuiz('B')"> Examen B</label>
        <label><input type="radio" name="exam_version" value="C" onclick="startQuiz('C')"> Examen C</label>
        <label><input type="radio" name="exam_version" value="D" onclick="startQuiz('D')"> Examen D</label>
    </div>

    <p id="instruction-text">Veuillez s√©lectionner une version d'examen (A, B, C ou D) pour commencer. **Chaque version contient 20 questions diff√©rentes.**</p>

    <div id="quiz-form-container">
        <form id="quiz-form">

            <div class="user-info-section">
                <h3>üë§ Informations de l'√âl√®ve (Obligatoire)</h3>
                <div class="user-info-field">
                    <label for="user-name">Nom et Pr√©nom :</label>
                    <input type="text" id="user-name" name="user_name" required>
                </div>
                <div style="display: flex; gap: 20px; flex-wrap: wrap;">
                    <div class="user-info-field" style="flex: 1;">
                        <label for="class-number"> Classe 1ASC- </label>
                        <select id="class-number" name="class_number" required>
                            <option value="">S√©lectionner</option>
                        </select>
                    </div>

                    <div class="user-info-field" style="flex: 1;">
                        <label for="student-number">N¬∞:</label>
                        <select id="student-number" name="student_number" required>
                            <option value="">S√©lectionner</option>
                        </select>
                    </div>
                </div>
            </div>

            <div id="questions-container">
                </div>


            <button type="button" class="submit-btn" onclick="calculateFinalScore()">Afficher le Score Final et Enregistrer</button>

            <div id="score-container">
                Score Final : <span id="final-score">0</span> / 20
            </div>

        </form>
    </div>
</div>

<script>
    // --- D√©finitions des questions pour les 4 versions (A, B, C, D) ---
    const quizData = {
        A: [
            // 1. D√©finition Information (Glisser-D√©poser)
            { id: 1, type: 'fill-in-the-blank', title: "Question 1/20 : D√©finition de l'Information (Glisser-D√©poser)", 
              text: "Une information est un [ensemble] de donn√©es ayant un [sens].", 
              words: ["ensemble", "donn√©es", "sens"] },
            // 2. Unit√© de base (Radio)
            { id: 2, type: 'radio', title: "Question 2/20 : Quelle est l'unit√© de base pour mesurer la capacit√© de stockage des informations (1 caract√®re) ?", 
              options: [{text: "Bit", correct: false}, {text: "Octet", correct: true}, {text: "Ko", correct: false}] },
            // 3. Hardware/Software (Matching)
            { id: 3, type: 'matching', title: "Question 3/20 : Reliez les termes anglais √† leur √©quivalent fran√ßais.", 
              terms: ["Hardware", "Software"], definitions: ["Mat√©riel informatique", "Logiciel"], answers: {"Hardware": "Mat√©riel informatique", "Software": "Logiciel"} },
            // 4. Source ou Support (Radio)
            { id: 4, type: 'radio', title: "Question 4/20 : Un livre est principalement un...", 
              options: [{text: "Support d'information", correct: true}, {text: "Source d'information", correct: false}] },
            // 5. Classification P√©riph√©rique (Checkbox)
            { id: 5, type: 'checkbox', title: "Question 5/20 : S√©lectionnez les p√©riph√©riques d'entr√©e.", 
              options: [{text: "Clavier", correct: true}, {text: "√âcran", correct: false}, {text: "Souris", correct: true}, {text: "Imprimante", correct: false}] },
            // 6. D√©finition Informatique (Glisser-D√©poser)
            { id: 6, type: 'fill-in-the-blank', title: "Question 6/20 : D√©finition de l'Informatique (Glisser-D√©poser)", 
              text: "L'informatique est la science du [traitement] [automatique] de l'[information].", 
              words: ["traitement", "programme", "automatique", "information"] },
            // 7. Composition Ordinateur (Radio)
            { id: 7, type: 'radio', title: "Question 7/20 : L'ordinateur est compos√© de combien de parties principales ?", 
              options: [{text: "Une (L'Unit√© Centrale)", correct: false}, {text: "Deux (UC et P√©riph√©riques)", correct: true}, {text: "Trois (Mat√©riel, Logiciel, Programmes)", correct: false}] },
            // 8. √âtapes Traitement (Matching)
            { id: 8, type: 'matching', title: "Question 8/20 : Mettez les √©tapes du traitement de l'information dans l'ordre (Cours 1).", 
              terms: ["√âtape 1", "√âtape 2", "√âtape 3"], definitions: ["Lire l'information", "Faire les op√©rations", "Donner les r√©sultats"], 
              answers: {"√âtape 1": "Lire l'information", "√âtape 2": "Faire les op√©rations", "√âtape 3": "Donner les r√©sultats"} },
            // 9. P√©riph√©rique Stockage R√¥le (Checkbox)
            { id: 9, type: 'checkbox', title: "Question 9/20 : Les p√©riph√©riques de stockage (Cl√© USB, Disque Dur...) sont aussi des p√©riph√©riques...", 
              options: [{text: "d'Entr√©e", correct: true}, {text: "de Sortie", correct: true}, {text: "de Traitement", correct: false}] },
            // 10. Vrai/Faux (Mat√©riel/Logiciel)
            { id: 10, type: 'radio', title: "Question 10/20 : Vrai ou Faux ? Le mat√©riel peut fonctionner tout seul sans les logiciels.", 
              options: [{text: "Vrai", correct: false}, {text: "Faux", correct: true}] },
            // 11. Domaines Utilit√© (Checkbox)
            { id: 11, type: 'checkbox', title: "Question 11/20 : Dans quels domaines l'informatique est-elle mentionn√©e comme utile dans le cours ?", 
              options: [{text: "La m√©decine", correct: true}, {text: "L'√©ducation", correct: true}, {text: "Le divertissement", correct: true}, {text: "La cuisine", correct: false}] },
            // 12. D√©finition Programme (Glisser-D√©poser)
            { id: 12, type: 'fill-in-the-blank', title: "Question 12/20 : Qu'est-ce qu'un Programme ? (Glisser-D√©poser)", 
              text: "Un programme est une liste d'[instructions] pour dire √† l'[ordinateur] ce qu'il doit [ex√©cuter].", 
              words: ["op√©rations", "instructions", "ordinateur", "ex√©cuter"] },
            // 13. Unit√© Centrale autre nom (Radio)
            { id: 13, type: 'radio', title: "Question 13/20 : L'Unit√© Centrale est aussi appel√©e :", 
              options: [{text: "√âcran", correct: false}, {text: "Bo√Ætier", correct: true}, {text: "P√©riph√©rique", correct: false}] },
            // 14. D√©finition Traitement (Glisser-D√©poser)
            { id: 14, type: 'fill-in-the-blank', title: "Question 14/20 : Traitement de l'information (Glisser-D√©poser)", 
              text: "Traiter une information, c'est lui appliquer des [op√©rations] pour obtenir de nouveaux renseignements appel√©s [r√©sultats].", 
              words: ["op√©rations", "analyses", "r√©sultats"] },
            // 15. P√©riph√©riques de Sortie (Checkbox)
            { id: 15, type: 'checkbox', title: "Question 15/20 : S√©lectionnez tous les P√©riph√©riques de Sortie list√©s ci-dessous.", 
              options: [{text: "Clavier", correct: false}, {text: "√âcran", correct: true}, {text: "Souris", correct: false}, {text: "Imprimante", correct: true}, {text: "Haut-parleurs", correct: true}] },
            // 16. Logiciel de Base vs Application (Matching)
            { id: 16, type: 'matching', title: "Question 16/20 : Associez le type de logiciel √† son exemple (Cours 5-6).", 
              terms: ["Logiciel de Base", "Logiciel d'Application"], definitions: ["Windows 7", "Ms Word", "Linux"], 
              answers: {"Logiciel de Base": "Windows 7", "Logiciel d'Application": "Ms Word"} },
            // 17. Conversion Unit√© (Radio)
            { id: 17, type: 'radio', title: "Question 17/20 : Combien d'octets y a-t-il dans 1 Ko ?", 
              options: [{text: "1000 octets", correct: false}, {text: "1024 octets", correct: true}, {text: "1024 Ko", correct: false}] },
            // 18. R√¥le de la Source (Radio)
            { id: 18, type: 'radio', title: "Question 18/20 : Une Source d'information est un moyen qui...", 
              options: [{text: "Garde l'information", correct: false}, {text: "Envoie l'information", correct: true}, {text: "Traite l'information", correct: false}] },
            // 19. Logiciel (groupe de...) (Radio)
            { id: 19, type: 'radio', title: "Question 19/20 : Un Logiciel est un groupe de :", 
              options: [{text: "Ordinateurs", correct: false}, {text: "P√©riph√©riques", correct: false}, {text: "Programmes", correct: true}] },
            // 20. Probl√®me de Stockage (Radio/Calcul)
            { id: 20, type: 'radio', title: "Question 20/20 : Un p√©riph√©rique de 64 Mo est-il suffisant pour stocker un dossier de 6500 Ko ?", 
              options: [{text: " (64*1024 Mo)", correct: true}, {text: " (64*1000 Go)", correct: false}, {text: " (6.4*1224 Mo )", correct: false}] }
        ],
        B: [
            // 1. D√©finition Informatique (Glisser-D√©poser)
            { id: 1, type: 'fill-in-the-blank', title: "Question 1/20 : D√©finition de l'Informatique (Glisser-D√©poser)", 
              text: "L'informatique est la science du [traitement] [automatique] de l'[information].", 
              words: ["traitement", "manuel", "automatique", "information"] },
            // 2. Plus petite unit√© (Radio)
            { id: 2, type: 'radio', title: "Question 2/20 : Quelle est la plus petite unit√© de donn√©es que l'ordinateur peut manipuler ?", 
              options: [{text: "Bit", correct: true}, {text: "Octet", correct: false}, {text: "Mo", correct: false}] },
            // 3. Mat√©riel/Logiciel (Matching)
            { id: 3, type: 'matching', title: "Question 3/20 : Reliez la partie du syst√®me informatique √† son r√¥le.", 
              terms: ["Mat√©riel", "Logiciel"], definitions: ["Corps de l'ordinateur", "Instructions", "P√©riph√©riques"], 
              answers: {"Mat√©riel": "Corps de l'ordinateur", "Logiciel": "Instructions"} },
            // 4. Source ou Support (Radio)
            { id: 4, type: 'radio', title: "Question 4/20 : Un journal est...", 
              options: [{text: "Seulement un Support", correct: false}, {text: "Un Support et une Source", correct: true}, {text: "Seulement une Source", correct: false}] },
            // 5. Classification P√©riph√©rique (Checkbox)
            { id: 5, type: 'checkbox', title: "Question 5/20 : S√©lectionnez les p√©riph√©riques de sortie.", 
              options: [{text: "Souris", correct: false}, {text: "Imprimante", correct: true}, {text: "Microphone", correct: false}, {text: "Haut-parleurs", correct: true}] },
            // 6. √âtapes Traitement (Matching)
            { id: 6, type: 'matching', title: "Question 6/20 : Mettez les √©tapes du traitement de l'information dans l'ordre (Cours 1).", 
              terms: ["1√®re √©tape", "2√®me √©tape", "3√®me √©tape"], definitions: ["Faire les op√©rations", "Lire l'information", "Donner les r√©sultats"], 
              answers: {"1√®re √©tape": "Lire l'information", "2√®me √©tape": "Faire les op√©rations", "3√®me √©tape": "Donner les r√©sultats"} },
            // 7. Vrai/Faux (Ordinateur)
            { id: 7, type: 'radio', title: "Question 7/20 : Vrai ou Faux ? Un ordinateur est constitu√© uniquement de p√©riph√©riques.", 
              options: [{text: "Vrai", correct: false}, {text: "Faux", correct: true}] },
            // 8. R√¥le du Logiciel de base (Radio)
            { id: 8, type: 'radio', title: "Question 8/20 : Le r√¥le d'un Logiciel de base (Syst√®me d'exploitation) est de...", 
              options: [{text: "R√©aliser des t√¢ches particuli√®res (Dessin, Calcul)", correct: false}, {text: "Assurer le bon fonctionnement de l'ordinateur", correct: true}, {text: "Stocker les donn√©es", correct: false}] },
            // 9. Intrus Information (Radio)
            { id: 9, type: 'radio', title: "Question 9/20 : Trouvez l'intrus (Le mot qui n'est PAS un synonyme/√©quivalent de l'Information).", 
              options: [{text: "Nouvelle", correct: false}, {text: "Cheval", correct: true}, {text: "Renseignement", correct: false}] },
            // 10. Vrai/Faux (Logiciel n√©cessaire)
            { id: 10, type: 'radio', title: "Question 10/20 : Vrai ou Faux ? Les logiciels ne peuvent rien faire s'ils n'ont pas de mat√©riel pour les ex√©cuter.", 
              options: [{text: "Vrai", correct: true}, {text: "Faux", correct: false}] },
            // 11. Conversion Unit√© (Matching)
            { id: 11, type: 'matching', title: "Question 11/20 : Reliez l'unit√© √† sa valeur correcte.", 
              terms: ["1 M√©gaoctet (Mo)", "1 Gigaoctet (Go)"], definitions: ["1024 Ko", "1024 Mo", "1024 Octets"], 
              answers: {"1 M√©gaoctet (Mo)": "1024 Ko", "1 Gigaoctet (Go)": "1024 Mo"} },
            // 12. D√©finition Traitement (Glisser-D√©poser)
            { id: 12, type: 'fill-in-the-blank', title: "Question 12/20 : Traitement de l'information (Glisser-D√©poser)", 
              text: "Traiter une information, c'est lui appliquer des [op√©rations] pour obtenir de nouveaux renseignements appel√©s [r√©sultats].", 
              words: ["op√©rations", "analyses", "r√©sultats"] },
            // 13. P√©riph√©riques de Stockage (Checkbox)
            { id: 13, type: 'checkbox', title: "Question 13/20 : S√©lectionnez les p√©riph√©riques qui SONT des p√©riph√©riques de stockage.", 
              options: [{text: "CD-ROM", correct: true}, {text: "Scanner", correct: false}, {text: "Cl√© USB", correct: true}, {text: "Disque dur", correct: true}] },
            // 14. D√©finition Programme (Glisser-D√©poser)
            { id: 14, type: 'fill-in-the-blank', title: "Question 14/20 : Qu'est-ce qu'un Programme ? (Glisser-D√©poser)", 
              text: "Un programme est une liste d'[instructions] pour dire √† l'[ordinateur] ce qu'il doit [ex√©cuter].", 
              words: ["op√©rations", "instructions", "ordinateur", "ex√©cuter"] },
            // 15. P√©riph√©rique qui fait les deux (Radio)
            { id: 15, type: 'radio', title: "Question 15/20 : Quel p√©riph√©rique est un p√©riph√©rique d'entr√©e ET de sortie ?", 
              options: [{text: "L'√©cran", correct: false}, {text: "Le clavier", correct: false}, {text: "Le Disque Dur", correct: true}] },
            // 16. Nom Logiciel de Base (Radio)
            { id: 16, type: 'radio', title: "Question 16/20 : Un logiciel de base est aussi appel√© :", 
              options: [{text: "Logiciel d'Application", correct: false}, {text: "Syst√®me d'Exploitation", correct: true}, {text: "Programme", correct: false}] },
            // 17. Fonction Moniteur (Matching)
            { id: 17, type: 'matching', title: "Question 17/20 : Reliez le p√©riph√©rique √† sa fonction.", 
              terms: ["Moniteur (√âcran)", "Scanner", "Microphone"], definitions: ["Permet l'affichage des informations", "Permet de num√©riser des documents", "Permet d'enregistrer le son"], 
              answers: {"Moniteur (√âcran)": "Permet l'affichage des informations", "Scanner": "Permet de num√©riser des documents", "Microphone": "Permet d'enregistrer le son"} },
            // 18. R√¥le du Support (Radio)
            { id: 18, type: 'radio', title: "Question 18/20 : Un Support d'information est une 'bo√Æte' qui...", 
              options: [{text: "Envoie l'information", correct: false}, {text: "Garde l'information", correct: true}, {text: "Fait des calculs", correct: false}] },
            // 19. Probl√®me de Stockage 2 (Radio/Calcul)
            { id: 19, type: 'radio', title: "Question 19/20 : Combien de Ko sont n√©cessaires pour stocker un fichier de 1 Mo ?", 
              options: [{text: "1000 Ko", correct: false}, {text: "1024 Ko", correct: true}, {text: "1024 Mo", correct: false}] },
            // 20. UC autre nom (Radio)
            { id: 20, type: 'radio', title: "Question 20/20 : L'Unit√© Centrale est responsable du...", 
              options: [{text: "Stockage des donn√©es", correct: false}, {text: "Traitement de l'information", correct: true}, {text: "Affichage des r√©sultats", correct: false}] }
        ],
        C: [
             // 1. Unit√© de base (Radio)
            { id: 1, type: 'radio', title: "Question 1/20 : Quelle unit√© sert √† stocker un seul caract√®re (lettre, chiffre) ?", 
              options: [{text: "Bit", correct: false}, {text: "Octet", correct: true}, {text: "Ko", correct: false}] },
            // 2. D√©finition Information (Glisser-D√©poser)
            { id: 2, type: 'fill-in-the-blank', title: "Question 2/20 : D√©finition de l'Information (Glisser-D√©poser)", 
              text: "L'information est un [ensemble] de [donn√©es] ayant du [sens].", 
              words: ["ensemble", "donn√©es", "chiffres", "sens"] },
            // 3. Logiciel de Base vs Application (Matching)
            { id: 3, type: 'matching', title: "Question 3/20 : Associez le type de logiciel √† sa description.", 
              terms: ["Logiciel de Base", "Logiciel d'Application"], definitions: ["Assure le bon fonctionnement de l'ordinateur", "Permet de r√©aliser des t√¢ches particuli√®res (Ex: Word)"], 
              answers: {"Logiciel de Base": "Assure le bon fonctionnement de l'ordinateur", "Logiciel d'Application": "Permet de r√©aliser des t√¢ches particuli√®res (Ex: Word)"} },
            // 4. Classification P√©riph√©rique (Checkbox)
            { id: 4, type: 'checkbox', title: "Question 4/20 : S√©lectionnez les p√©riph√©riques d'entr√©e.", 
              options: [{text: "√âcran", correct: false}, {text: "Clavier", correct: true}, {text: "Imprimante", correct: false}, {text: "Microphone", correct: true}] },
            // 5. Unit√© Centrale autre nom (Radio)
            { id: 5, type: 'radio', title: "Question 5/20 : L'Unit√© Centrale est le 'cerveau' de l'ordinateur, aussi appel√© :", 
              options: [{text: "P√©riph√©rique", correct: false}, {text: "Logiciel", correct: false}, {text: "Bo√Ætier", correct: true}] },
            // 6. Domaine d'Utilit√© (Radio)
            { id: 6, type: 'radio', title: "Question 6/20 : Parmi les domaines suivants, lequel est mentionn√© dans le cours comme une utilit√© de l'informatique ?", 
              options: [{text: "La Menuiserie", correct: false}, {text: "Le Divertissement", correct: true}, {text: "L'Agriculture", correct: false}] },
            // 7. Vrai/Faux (Syst√®me Informatique)
            { id: 7, type: 'radio', title: "Question 7/20 : Vrai ou Faux ? Un syst√®me informatique est un ensemble d'ordinateurs (Mat√©riel uniquement).", 
              options: [{text: "Vrai", correct: false}, {text: "Faux", correct: true}] },
            // 8. √âtapes Traitement (Matching)
            { id: 8, type: 'matching', title: "Question 8/20 : Reliez l'action √† son √©tape dans le traitement de l'information.", 
              terms: ["Lire l'information", "Faire les op√©rations", "Donner les r√©sultats"], definitions: ["Premi√®re √©tape", "Deuxi√®me √©tape", "Troisi√®me √©tape"], 
              answers: {"Lire l'information": "Premi√®re √©tape", "Faire les op√©rations": "Deuxi√®me √©tape", "Donner les r√©sultats": "Troisi√®me √©tape"} },
            // 9. R√¥le du Traitement (Glisser-D√©poser)
            { id: 9, type: 'fill-in-the-blank', title: "Question 9/20 : R√¥le du Traitement (Glisser-D√©poser)", 
              text: "Traiter l'information signifie obtenir de nouveaux renseignements appel√©s [r√©sultats] en appliquant des [op√©rations].", 
              words: ["analyses", "r√©sultats", "donn√©es", "op√©rations"] },
            // 10. Vrai/Faux (DD Stockage)
            { id: 10, type: 'radio', title: "Question 10/20 : Vrai ou Faux ? Le disque dur est un p√©riph√©rique de stockage.", 
              options: [{text: "Vrai", correct: true}, {text: "Faux", correct: false}] },
            // 11. Fonction Souris/Clavier (Matching)
            { id: 11, type: 'matching', title: "Question 11/20 : Reliez le p√©riph√©rique √† sa fonction.", 
              terms: ["La souris", "Le clavier"], definitions: ["Saisir des lettres et des chiffres", "S√©lectionner et manipuler des objets"], 
              answers: {"La souris": "S√©lectionner et manipuler des objets", "Le clavier": "Saisir des lettres et des chiffres"} },
            // 12. P√©riph√©rique Entr√©e/Sortie (Checkbox)
            { id: 12, type: 'checkbox', title: "Question 12/20 : Parmi les p√©riph√©riques suivants, quels sont ceux de **Sortie** ?", 
              options: [{text: "√âcran", correct: true}, {text: "Souris", correct: false}, {text: "Haut-parleurs", correct: true}, {text: "Scanner", correct: false}] },
            // 13. D√©finition Programme (Radio)
            { id: 13, type: 'radio', title: "Question 13/20 : Un Programme est :", 
              options: [{text: "Une liste de p√©riph√©riques", correct: false}, {text: "Un groupe de logiciels", correct: false}, {text: "Une liste d'instructions pour l'ordinateur", correct: true}] },
            // 14. Support ou Source (Radio)
            { id: 14, type: 'radio', title: "Question 14/20 : La t√©l√©vision est principalement une...", 
              options: [{text: "Source d'information", correct: true}, {text: "Support d'information", correct: false}, {text: "Unit√© centrale", correct: false}] },
            // 15. Vocabulaire Anglais (Matching)
            { id: 15, type: 'matching', title: "Question 15/20 : Reliez les termes fran√ßais √† leur √©quivalent anglais.", 
              terms: ["Mat√©riel informatique", "Logiciel"], definitions: ["Software", "Hardware"], 
              answers: {"Mat√©riel informatique": "Hardware", "Logiciel": "Software"} },
            // 16. Nom Logiciel de Base (Radio)
            { id: 16, type: 'radio', title: "Question 16/20 : Windows 7 est un exemple de :", 
              options: [{text: "Logiciel d'Application", correct: false}, {text: "Logiciel de Base", correct: true}, {text: "Programme", correct: false}] },
            // 17. Conversion Unit√© (Radio)
            { id: 17, type: 'radio', title: "Question 17/20 : 1 Go est √©gal √† :", 
              options: [{text: "1024 Ko", correct: false}, {text: "1024 Mo", correct: true}, {text: "1024 Octets", correct: false}] },
            // 18. D√©finition Informatique (Glisser-D√©poser)
            { id: 18, type: 'fill-in-the-blank', title: "Question 18/20 : L'informatique vient des mots :", 
              text: "L'informatique vient des mots [information] et [automatique].", 
              words: ["information", "automatique", "traitement"] },
            // 19. Vrai/Faux (D√©brancher P√©riph√©rique)
            { id: 19, type: 'radio', title: "Question 19/20 : Vrai ou Faux ? Pour d√©brancher des p√©riph√©riques plus anciennes(sauf USB), il est conseill√© d'√©teindre l'ordinateur.", 
              options: [{text: "Vrai", correct: true}, {text: "Faux", correct: false}] },
            // 20. Probl√®me de Stockage (Radio/Calcul)
            { id: 20, type: 'radio', title: "Question 20/20 : La capacit√© d'un p√©riph√©rique de stockage est 64 Mo. Peut-il stocker un dossier de 6500 Ko ?", 
              options: [{text: "car 6500 Ko = 6.3 Mo environ.", correct: true}, {text: "car 6500 Ko est plus grand que 64 Mo.", correct: false}] }
        ],
        D: [
             // 1. D√©finition Programme (Glisser-D√©poser)
            { id: 1, type: 'fill-in-the-blank', title: "Question 1/20 : Qu'est-ce qu'un Programme ? (Glisser-D√©poser)", 
              text: "Un programme est une liste d'[instructions] pour dire √† l'[ordinateur] ce qu'il doit [ex√©cuter].", 
              words: ["op√©rations", "instructions", "ordinateur", "ex√©cuter"] },
            // 2. Hardware/Software (Matching)
            { id: 2, type: 'matching', title: "Question 2/20 : Reliez les termes anglais √† leur √©quivalent fran√ßais.", 
              terms: ["Logiciel", "Mat√©riel informatique"], definitions: ["Hardware", "Software"], answers: {"Logiciel": "Software", "Mat√©riel informatique": "Hardware"} },
            // 3. Unit√© de base (Radio)
            { id: 3, type: 'radio', title: "Question 3/20 : La capacit√© de stockage d'un p√©riph√©rique est mesur√©e en...", 
              options: [{text: "Octets", correct: true}, {text: "Bits", correct: false}, {text: "Caract√®res", correct: false}] },
            // 4. Source ou Support (Radio)
            { id: 4, type: 'radio', title: "Question 4/20 : La t√©l√©vision donne des informations mais ne les garde pas. C'est principalement une...", 
              options: [{text: "Source", correct: true}, {text: "Support", correct: false}, {text: "Unit√© Centrale", correct: false}] },
            // 5. Vrai/Faux (Unit√© Centrale)
            { id: 5, type: 'radio', title: "Question 5/20 : Vrai ou Faux ? Un ordinateur ne peut pas fonctionner sans unit√© centrale.", 
              options: [{text: "Vrai", correct: true}, {text: "Faux", correct: false}] },
            // 6. Classification P√©riph√©rique (Checkbox)
            { id: 6, type: 'checkbox', title: "Question 6/20 : S√©lectionnez les p√©riph√©riques qui facilitent l'entr√©e d'informations (P√©riph√©riques d'Entr√©e).", 
              options: [{text: "Clavier", correct: true}, {text: "√âcran", correct: false}, {text: "Souris", correct: true}, {text: "Imprimante", correct: false}, {text: "Microphone", correct: true}] },
            // 7. D√©finition Informatique (Glisser-D√©poser)
            { id: 7, type: 'fill-in-the-blank', title: "Question 7/20 : D√©finition de l'Informatique (Glisser-D√©poser)", 
              text: "L'informatique est une science qui regarde comment les machines peuvent traiter [automatiquement] l'[information].", 
              words: ["manuellement", "automatiquement", "information"] },
            // 8. √âtapes Traitement (Matching)
            { id: 8, type: 'matching', title: "Question 8/20 : Reliez l'action √† son √©tape dans le traitement de l'information.", 
              terms: ["√âtape 1", "√âtape 2", "√âtape 3"], definitions: ["Faire les op√©rations", "Donner les r√©sultats", "Lire l'information"], 
              answers: {"√âtape 1": "Lire l'information", "√âtape 2": "Faire les op√©rations", "√âtape 3": "Donner les r√©sultats"} },
            // 9. Logiciel (groupe de...) (Radio)
            { id: 9, type: 'radio', title: "Question 9/20 : Un Logiciel est un groupe de...", 
              options: [{text: "Programmes", correct: true}, {text: "P√©riph√©riques", correct: false}, {text: "Unit√©s Centrales", correct: false}] },
            // 10. Vrai/Faux (Mat√©riel/Logiciel)
            { id: 10, type: 'radio', title: "Question 10/20 : Vrai ou Faux ? Le mat√©riel doit √™tre g√©r√© par un syst√®me d'exploitation pour fonctionner correctement.", 
              options: [{text: "Vrai", correct: true}, {text: "Faux", correct: false}] },
            // 11. Fonction Imprimante/Haut-parleurs (Matching)
            { id: 11, type: 'matching', title: "Question 11/20 : Reliez le p√©riph√©rique de Sortie √† sa fonction.", 
              terms: ["Imprimante", "Haut-parleurs"], definitions: ["Permet d'imprimer les informations sur papier", "Permet la transmission du son"], 
              answers: {"Imprimante": "Permet d'imprimer les informations sur papier", "Haut-parleurs": "Permet la transmission du son"} },
            // 12. P√©riph√©rique Stockage R√¥le (Checkbox)
            { id: 12, type: 'checkbox', title: "Question 12/20 : Les p√©riph√©riques de stockage servent √† la fois √† :", 
              options: [{text: "Entrer les informations", correct: true}, {text: "Traiter les informations", correct: false}, {text: "Sortir les informations", correct: true}] },
            // 13. D√©finition Information (Glisser-D√©poser)
            { id: 13, type: 'fill-in-the-blank', title: "Question 13/20 : D√©finition de l'Information (Glisser-D√©poser)", 
              text: "L'information nous donne des renseignements sous forme de [texte], d'[image] ou de [son].", 
              words: ["texte", "couleur", "image", "son"] },
            // 14. Intrus Information (Radio)
            { id: 14, type: 'radio', title: "Question 14/20 : Trouvez l'intrus (Le seul qui est li√© √† l'Information).", 
              options: [{text: "Cheval", correct: false}, {text: "Nouvelle", correct: true}, {text: "Arbre", correct: false}] },
            // 15. Logiciel de Base vs Application (Matching)
            { id: 15, type: 'matching', title: "Question 15/20 : Associez l'exemple de logiciel √† son type.", 
              terms: ["Ms Excel", "Linux"], definitions: ["Logiciel d'Application", "Logiciel de Base"], 
              answers: {"Ms Excel": "Logiciel d'Application", "Linux": "Logiciel de Base"} },
            // 16. Conversion Unit√© (Radio)
            { id: 16, type: 'radio', title: "Question 16/20 : 1 Mo est √©gal √† :", 
              options: [{text: "1024 Octets", correct: false}, {text: "1024 Ko", correct: true}, {text: "1024 Go", correct: false}] },
            // 17. Partie principale de l'ordinateur (Radio)
            { id: 17, type: 'radio', title: "Question 17/20 : Les P√©riph√©riques sont...", 
              options: [{text: "Des dispositifs externes connect√©s √† l'UC", correct: true}, {text: "Le cerveau de l'ordinateur", correct: false}, {text: "Le logiciel de base", correct: false}] },
            // 18. R√¥le du Traitement (Radio)
            { id: 18, type: 'radio', title: "Question 18/20 : L'action de **traiter** l'information implique :", 
              options: [{text: "Uniquement lire l'information", correct: false}, {text: "Faire des op√©rations (calculs, classement)", correct: true}, {text: "Uniquement stocker les r√©sultats", correct: false}] },
            // 19. Domaine d'Utilit√© (Checkbox)
            { id: 19, type: 'checkbox', title: "Question 19/20 : L'informatique rend les choses plus faciles et rapides dans quels domaines ?", 
              options: [{text: "La M√©decine", correct: true}, {text: "L'√âducation", correct: true}, {text: "La Ma√ßonnerie", correct: false}] },
            // 20. D√©finition Programme (Radio)
            { id: 20, type: 'radio', title: "Question 20/20 : Qu'est-ce que le **Software** ?", 
              options: [{text: "L'unit√© centrale", correct: false}, {text: "Le corps de l'ordinateur", correct: false}, {text: "Les instructions (Logiciel)", correct: true}] }
        ]
    };
    
    // Global state
    let finalScore = 0;
    let dragged = null;
    let isQuizCompleted = false;
    let currentExamVersion = null; 
    let currentQuestions = [];

    // --- Fonctions de base et utilitaires ---

    // Remplissage des listes d√©roulantes pour l'identification
    function populateSelects() {
        const classSelect = document.getElementById('class-number');
        const studentSelect = document.getElementById('student-number');

        for (let i = 1; i <= 25; i++) {
            classSelect.innerHTML += `<option value="${i}">${i}</option>`;
        }
        for (let i = 1; i <= 50; i++) {
            studentSelect.innerHTML += `<option value="${i}">${i}</option>`;
        }
    }
    document.addEventListener('DOMContentLoaded', populateSelects);

    // Normalisation du texte pour la comparaison des r√©ponses
    function normalizeText(text) {
        return text.trim().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "").replace(/[^a-z0-9]/g, '');
    }


    // --- Logique de Rendu des Questions ---

    /**
     * G√©n√®re l'HTML pour les questions dynamiquement.
     */
    function renderQuestions(questions) {
        const container = document.getElementById('questions-container');
        container.innerHTML = '';
        currentQuestions = questions;

        questions.forEach((q, index) => {
            let html = '';
            const qNum = index + 1;
            const qName = `q${qNum}`; // Nom unique pour les inputs

            if (q.type === 'radio' || q.type === 'checkbox') {
                html = '<div class="options">';
                q.options.forEach((opt) => {
                    const checkedState = q.type === 'checkbox' && opt.correct ? 'data-correct="true"' : `data-correct="${opt.correct}"`;
                    html += `<label><input type="${q.type}" name="${qName}" value="${opt.text}" ${checkedState}> <span>${opt.text}</span></label>`;
                });
                html += '</div>';

            } else if (q.type === 'fill-in-the-blank') {
                // Rendu des mots √† glisser
                html += '<div class="drag-zone" id="drag-q' + qNum + '">';
                // M√©langer les mots pour √©viter la ressemblance avec la version pr√©c√©dente
                const shuffledWords = q.words.sort(() => Math.random() - 0.5); 
                shuffledWords.forEach(word => {
                    html += `<div class="drag-word" draggable="true" data-word="${word}">${word}</div>`;
                });
                html += '</div>';

                // Rendu de la phrase avec les zones de d√©p√¥t
                let text = q.text;
                // Remplacer les [mot] par la zone de d√©p√¥t, en conservant le mot correct pour la v√©rification
                q.words.forEach(word => {
                    // V√©rifier si le mot est attendu comme r√©ponse
                    if (q.text.includes(`[${word}]`)) {
                         const dropTargetHtml = `<span class="drop-target" data-correct-word="${word}"></span>`;
                         text = text.replace(`[${word}]`, dropTargetHtml);
                    }
                });

                html += `<p class="question-text-line">${text}</p>`;

            } else if (q.type === 'matching') {
                html += '<div id="q' + qNum + '-matching">';
                
                // Cr√©er la liste des d√©finitions pour la liste d√©roulante (m√©lang√©es)
                const allDefinitions = q.definitions.slice().sort(() => Math.random() - 0.5);

                q.terms.forEach(term => {
                    let selectOptions = `<option value="">S√©lectionner</option>`;
                    allDefinitions.forEach(def => {
                        selectOptions += `<option value="${def}">${def}</option>`;
                    });

                    html += `
                        <div class="matching-pair" data-term="${term}">
                            <div class="term">${term}</div>
                            <select class="definition-select" name="${qName}-${term}" data-term-target="${term}">
                                ${selectOptions}
                            </select>
                        </div>
                    `;
                });
                html += '</div>';
            }

            // Assemblage de la question compl√®te
            const questionHtml = `
                <div class="question-section" data-id="${qNum}" data-type="${q.type}">
                    <div class="question-title">${q.title}</div>
                    ${html}
                </div>
            `;
            container.innerHTML += questionHtml;
        });

        // R√©activer le Drag and Drop apr√®s l'injection HTML
        initDragAndDrop();
    }


    /**
     * D√©marre le quiz en chargeant les questions de la version s√©lectionn√©e.
     */
    function startQuiz(version) {
        if (isQuizCompleted && version === currentExamVersion) return; 

        currentExamVersion = version;
        const questions = quizData[version];
        
        document.getElementById('instruction-text').style.display = 'none';
        
        // Rendre les questions
        renderQuestions(questions);

        // Afficher le formulaire avec une transition
        const quizContainer = document.getElementById('quiz-form-container');
        quizContainer.style.display = 'block';
        setTimeout(() => quizContainer.style.opacity = '1', 10);
        
        // R√©initialiser le score et le bouton
        isQuizCompleted = false;
        document.getElementById('final-score').textContent = 0;
        const finalSubmitBtn = document.querySelector('.submit-btn');
        finalSubmitBtn.textContent = `Afficher le Score Final et Enregistrer`;
        finalSubmitBtn.disabled = false;
        document.querySelectorAll('.question-section').forEach(section => {
            section.classList.remove('correct', 'incorrect', 'checked');
        });
    }
    
    // --- Logique de v√©rification pour une seule question ---
    function checkQuestion(qId) {
        const section = document.querySelector(`.question-section[data-id="${qId}"]`);
        const type = section.getAttribute('data-type');
        const questionData = currentQuestions[qId - 1];
        let score = 0;

        // D√©sactiver toutes les entr√©es de la section
        section.querySelectorAll('input, select, .drag-word').forEach(el => {
            if (el.tagName === 'DIV' && el.classList.contains('drag-word')) {
                el.draggable = false;
            } else if (el.tagName !== 'BUTTON') {
                el.disabled = true;
            }
        });
        
        section.classList.add('checked');

        if (type === 'fill-in-the-blank') {
            const dropTargets = section.querySelectorAll('.drop-target');
            let currentCorrect = 0;
            let totalWords = 0;

            dropTargets.forEach((target) => {
                const filledWordElement = target.querySelector('.drag-word');
                const correctWord = normalizeText(target.getAttribute('data-correct-word'));
                totalWords++;
                
                if (filledWordElement) {
                    const filledWord = normalizeText(filledWordElement.getAttribute('data-word'));
                    if (filledWord === correctWord) {
                        currentCorrect++;
                        filledWordElement.style.backgroundColor = '#5cb85c'; // Vert
                    } else {
                        filledWordElement.style.backgroundColor = '#d9534f'; // Rouge
                    }
                }
            });
            score = (currentCorrect === totalWords) ? 1 : 0;

        } else if (type === 'radio') {
            const selectedInput = section.querySelector(`input[name="q${qId}"]:checked`);
            const correctAnswer = questionData.options.find(opt => opt.correct)?.text;

            if (selectedInput && normalizeText(selectedInput.value) === normalizeText(correctAnswer)) {
                score = 1;
            }

        } else if (type === 'checkbox') {
            const correctOptions = questionData.options.filter(opt => opt.correct).map(opt => normalizeText(opt.text)).sort();
            const selectedOptions = Array.from(section.querySelectorAll(`input[name="q${qId}"]:checked`))
                .map(input => normalizeText(input.value)).sort();
            
            const isCorrect = correctOptions.length === selectedOptions.length && 
                              correctOptions.every((val, index) => val === selectedOptions[index]);

            score = isCorrect ? 1 : 0;

        } else if (type === 'matching') {
            let currentCorrect = 0;
            const totalMappings = questionData.terms.length;
            
            questionData.terms.forEach(term => {
                const select = section.querySelector(`[data-term-target="${term}"]`);
                const correctDef = questionData.answers[term];
                const pair = section.querySelector(`.matching-pair[data-term="${term}"]`);

                if (select) {
                    if (select.value === correctDef) {
                        currentCorrect++;
                        pair.classList.add('correct');
                    } else {
                        pair.classList.add('incorrect');
                    }
                }
            });
            score = (currentCorrect === totalMappings) ? 1 : 0;
        }

        // Colorer la section de la question
        if (score === 1) {
            section.classList.add('correct');
        } else {
            section.classList.add('incorrect');
        }
        return score;
    }
    
    // --- Fonction de sauvegarde du fichier texte (t√©l√©chargement client-side) ---
    function saveResultToFile(content, userName, examVersion) {
        // Nettoyer le nom pour le nom de fichier
        const cleanName = userName.replace(/[^a-zA-Z0-9\s]/g, '').trim().replace(/\s+/g, '_');
        const fileName = `Resultats_${cleanName}_Examen${examVersion}.txt`;
        
        const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
        const link = document.createElement('a');
        
        link.href = URL.createObjectURL(blob);
        link.download = fileName;
        
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        
        alert(`Le score a √©t√© enregistr√© dans le fichier: "${fileName}"`);
    }

    // --- Fonction de calcul du score final ---
    function calculateFinalScore() {
        if (isQuizCompleted) return;
        if (!currentExamVersion) {
            alert("Veuillez s√©lectionner une version d'examen (A, B, C ou D) pour continuer.");
            return;
        }
        
        // 1. Validation des champs obligatoires
        const userName = document.getElementById('user-name').value.trim();
        const classNumber = document.getElementById('class-number').value;
        const studentNumber = document.getElementById('student-number').value;
        
        if (!userName || !classNumber || !studentNumber) {
            alert("Veuillez remplir toutes les informations de l'√©l√®ve (Nom, Classe, et Num√©ro d'Utilisateur) avant de soumettre.");
            return;
        }
        
        // Confirmation avant la soumission
        if (!confirm(`√ätes-vous certain de vouloir terminer l'examen ${currentExamVersion} (20 questions) et afficher votre score final ?`)) {
            return;
        }

        finalScore = 0; 
        const totalQuestions = currentQuestions.length;

        // Boucle sur toutes les questions pour calculer le score
        for (let qId = 1; qId <= totalQuestions; qId++) {
            finalScore += checkQuestion(qId);
        }
        
        // Mettre √† jour l'affichage du score
        document.getElementById('final-score').textContent = finalScore;

        // --- Pr√©paration et sauvegarde du fichier ---
        const fileContent = `
--- R√âSULTATS EXAMEN INFORMATIQUE ---

Date de Soumission: ${new Date().toLocaleString('fr-FR')}
Version d'Examen: ${currentExamVersion}

INFORMATIONS DE L'√âL√àVE:
Nom et Pr√©nom: ${userName}
Classe 1ASC- ${classNumber}
N¬∞ d'√©l√®ve: ${studentNumber}

SCORE FINAL: ${finalScore} / ${totalQuestions}
---
`;
        saveResultToFile(fileContent, userName, currentExamVersion);
        
        // D√©sactiver le bouton de soumission
        const finalSubmitBtn = document.querySelector('.submit-btn');
        finalSubmitBtn.textContent = `Score Calcul√© pour l'Examen ${currentExamVersion} : ${finalScore} / ${totalQuestions}`;
        finalSubmitBtn.disabled = true;
        
        isQuizCompleted = true; // Marquer le quiz comme termin√©
    }
    
    // --- Fonctions de Drag and Drop (Glisser-D√©poser) ---
    function initDragAndDrop() {
        // Supprimer les anciens √©couteurs pour √©viter les doubles ex√©cutions
        document.querySelectorAll('.drag-word').forEach(word => {
            word.removeEventListener('dragstart', handleDragStart);
            word.removeEventListener('dragend', handleDragEnd); 
        });
        document.querySelectorAll('.drop-target, .drag-zone').forEach(el => {
            el.removeEventListener('dragover', handleDragOver);
            el.removeEventListener('dragleave', handleDragLeave);
            el.removeEventListener('drop', handleDrop);
        });

        // Ajouter les nouveaux √©couteurs
        document.querySelectorAll('.drag-word').forEach(word => {
            word.addEventListener('dragstart', handleDragStart);
            word.addEventListener('dragend', handleDragEnd); 
        });

        document.querySelectorAll('.drop-target, .drag-zone').forEach(el => {
            el.addEventListener('dragover', handleDragOver);
            el.addEventListener('dragleave', handleDragLeave);
            el.addEventListener('drop', handleDrop);
        });
    }

    function handleDragStart(e) {
        if (isQuizCompleted || e.target.draggable === false) {
             e.preventDefault();
             return;
        }
        dragged = e.target;
        e.dataTransfer.setData('text/plain', e.target.getAttribute('data-word'));
        setTimeout(() => e.target.style.opacity = '0.5', 0);
    }

    function handleDragOver(e) {
        if (isQuizCompleted) return;
        e.preventDefault();
        const isDropTarget = e.target.classList.contains('drop-target');
        const isDragZone = e.target.classList.contains('drag-zone');
        
        // Autoriser le d√©p√¥t si:
        // 1. C'est une zone de d√©p√¥t ET elle est vide.
        // 2. C'est la zone des mots √† glisser.
        if ((isDropTarget && !e.target.querySelector('.drag-word')) || isDragZone) {
            e.target.classList.add('hover');
        }
    }

    function handleDragLeave(e) {
        if (e.target.classList.contains('drop-target') || e.target.classList.contains('drag-zone')) {
            e.target.classList.remove('hover');
        }
    }
    
    function handleDragEnd(e) {
        e.target.style.opacity = '1';
    }

    function handleDrop(e) {
        if (isQuizCompleted) return;
        e.preventDefault();
        const dropTarget = e.target;
        const currentDragged = dragged;

        if (!currentDragged) return;

        // 1. D√©poser sur une cible vide (.drop-target)
        if (dropTarget.classList.contains('drop-target') && !dropTarget.querySelector('.drag-word')) {
            const formerParent = currentDragged.parentElement;
            if (formerParent && formerParent.classList.contains('drop-target')) {
                formerParent.classList.remove('filled');
            }
            
            dropTarget.classList.remove('hover');
            dropTarget.classList.add('filled');
            dropTarget.appendChild(currentDragged);

        // 2. D√©poser sur la zone de mots √† glisser (.drag-zone)
        } else if (dropTarget.classList.contains('drag-zone')) {
            const formerParent = currentDragged.parentElement;
            dropTarget.appendChild(currentDragged);

            if (formerParent && formerParent.classList.contains('drop-target')) {
                formerParent.classList.remove('filled');
            }
        // 3. D√©poser sur un mot (pour l'√©changer)
        } else if (dropTarget.classList.contains('drag-word')) {
            const targetParent = dropTarget.parentElement;
            const formerParent = currentDragged.parentElement;
            
            // √âchanger les mots seulement si les deux sont dans des cibles
            if (targetParent.classList.contains('drop-target') && formerParent.classList.contains('drop-target')) {
                 targetParent.appendChild(currentDragged);
                 formerParent.appendChild(dropTarget);
            }
            dropTarget.classList.remove('hover'); 
            
        } else {
             // Si on l√¢che le mot ailleurs (par exemple sur le texte de la question), le remettre dans son parent initial
            if (currentDragged.style.opacity === '0.5' && currentDragged.parentElement) {
                // Rien √† faire ici, handleDragEnd le g√®re
            }
        }
        dragged = null;
    }

</script>

</body>
</html>
